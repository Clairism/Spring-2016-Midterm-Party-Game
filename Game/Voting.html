<!DOCTYPE html>
<html>
<head>
	<title>Voting for Large</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
	<script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>

</head>

<body>
	<div id="waiting"> 
		<h1 id="title">Waiting for players to upload...</h1>
	</div>

	<div id="done">
		<h1 id="title">Select 2 Silly Objects</h1>

		<script type="text/javascript">


		//imgs parent
		var clickedImg = new Firebase("https://incandescent-heat-4986.firebaseio.com/imgs/");

		var newpath = new Firebase("https://incandescent-heat-4986.firebaseio.com/images/");
		//Add code to loop through the database images instead of the folder path?

		var imgVotes = clickedImg.child("imgVotes");
		var votesForSilly = imgVotes.child('votesForSilly');

			$("#done").hide();


		//imgs parent
		var imgs = new Firebase("https://incandescent-heat-4986.firebaseio.com/imgs/");
		var imgVotes = imgs.child("imgVotes");
		var votesForSilly = imgVotes.child("votesForSilly");

		//display imgs from folder url
		var folder = "uploads/";

		$.ajax({
			url : folder,
			success: function (data) { //loop
			//console.log("data", data);
			$(data).find("a").attr("href", function (i, val) {
				if( val.match(/\.(jpe?g|png|gif|JPG)$/) ) { 
					$("#done").append( "<img src='"+ folder + val + "'>" );
					console.log("image count", i);
				}
				if (i >= 3){
					$("#waiting").hide();
					$("#done").show();
				}

			});

			$("img").on("click", function () {
				//img click event

				//this limits the number of imgs you can highlight at a time
				var $this = $(this);

				$this.toggleClass('highlight', !$this.hasClass('highlight') && $('img.highlight').length < 2);

				//get img src
				//console.log( "img src", $(this).attr('src'));
				
				//$(this).toggleClass('highlight');
				

				//push src test
				// var pushImg = votesForSilly.push();
				// pushImg.set({ 
				//  "clicked": $(this).attr('src') 
				//});

				//hightlight -- votes
				if ( $(this).hasClass('highlight') ) {

					votesForSilly.transaction(function (current_value) {
						return (current_value || 0) + 1;
					});

					// votesForSilly.child($(this).attr('src')).transaction(function (current_value) {
					// 	return (current_value || 0) + 1;
					// });

				}else{
					votesForSilly.transaction(function (current_value) {
						if(current_value <= 0){
							return current_value = 0;
							//votesForSilly.child('$(this).attr('src')').remove();

						}else{
							return current_value - 1;
						}
					});

					// votesForSillys.child($(this).attr('src')).transaction(function (current_value) {
					// 	if(current_value = 0){
					// 		votesForSilly.child($(this).attr('src')).remove();
					// 	}else{
					// 		return current_value - 1;
					// 	}
					// });

				}
					//$(this).addClass('clicked');
				});
		}
	});

</script>

<style>

	img.highlight {
		border: 8px rgb(25, 255, 0) ridge;
	}

</style>

<p>	

	<a href="Voting2.html">Submit Votes</a>
</p>
</div>
</body>
</html>